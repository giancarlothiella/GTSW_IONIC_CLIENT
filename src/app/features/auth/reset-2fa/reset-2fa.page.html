<!-- src/app/features/auth/reset-2fa/reset-2fa.page.html -->
<ion-content class="ion-padding">
  <div class="reset-2fa-container">
    <div class="reset-2fa-header">
      <ion-icon name="shield-outline" class="header-icon"></ion-icon>
      <h1>Reset autenticazione 2FA</h1>
      <p class="subtitle">Inserisci il tuo indirizzo email e la chiave segreta ricevuta per reimpostare l'autenticazione a due fattori.</p>
    </div>

    <form class="reset-2fa-form" (submit)="onSubmit($event)">
      <dx-form [formData]="formData" [disabled]="loading">
        <dxi-item
          dataField="email"
          editorType="dxTextBox"
          [editorOptions]="emailEditorOptions"
        >
          <dxi-validation-rule
            type="required"
            message="Email richiesta"
          ></dxi-validation-rule>
          <dxi-validation-rule
            type="email"
            message="Email non valida"
          ></dxi-validation-rule>
          <dxo-label caption="Email"></dxo-label>
        </dxi-item>

        <dxi-item
          dataField="reset2FATOTPSecret"
          editorType="dxTextBox"
          [editorOptions]="secretKeyEditorOptions"
        >
          <dxi-validation-rule
            type="required"
            message="Chiave segreta richiesta"
          ></dxi-validation-rule>
          <dxo-label caption="Chiave segreta 2FA"></dxo-label>
        </dxi-item>

        <dxi-item itemType="button">
          <dxo-button-options
            width="100%"
            type="default"
            [useSubmitBehavior]="true"
            [template]="'submitTemplate'"
            [elementAttr]="{ class: 'submit-button' }"
          >
          </dxo-button-options>
        </dxi-item>

        <dxi-item>
          <div class="back-link">
            Torna alla <a (click)="onBackToLogin()">pagina di login</a>
          </div>
        </dxi-item>

        <ng-container *dxTemplate="let item of 'submitTemplate'">
          <span class="dx-button-text">
            @if (loading) {
              <dx-load-indicator
                width="24px"
                height="24px"
                [visible]="true"
              ></dx-load-indicator>
            } @else {
              Reset autenticazione 2FA
            }
          </span>
        </ng-container>
      </dx-form>
    </form>
  </div>
</ion-content>
