<div class="pageFormat">
  <app-gts-loader></app-gts-loader>

  <!-- PrimeNG Toast for notifications -->
  <p-toast position="top-center" [style]="{ marginTop: '60px' }"></p-toast>

  <!-- Confirm Dialog -->
  <p-dialog
    [(visible)]="showConfirmDialog"
    [header]="confirmDialogHeader"
    [modal]="true"
    [closable]="true"
    [style]="{ width: '400px' }"
    [draggable]="false"
    [resizable]="false"
    appendTo="body"
    [baseZIndex]="10000">
    <p class="confirm-message">{{ confirmDialogMessage }}</p>
    <div class="confirm-dialog-footer">
      <button
        pButton
        type="button"
        class="p-button-secondary"
        [label]="confirmDialogRejectLabel"
        icon="pi pi-times"
        (click)="onConfirmReject()">
      </button>
      <button
        pButton
        type="button"
        class="p-button-danger"
        [label]="confirmDialogAcceptLabel"
        icon="pi pi-check"
        (click)="onConfirmAccept()">
      </button>
    </div>
  </p-dialog>

  <!-- Hidden file input for LOAD_EXCEL custom code -->
  <input type="file"
         #excelFileInput
         accept=".xlsx,.xls"
         style="display: none"
         (change)="onExcelFileSelected($event)">

  <app-gts-toolbar
    [prjId]="prjId"
    [formId]="formId"
    [objectName]="'mainToolbar'"
    [customData]="customData"
    (newValueEvent)="gtsDataService.toolbarSelectEvent($event)"
  ></app-gts-toolbar>

  <!-- STANDARD GTS PAGE CONTENT -->
  @if (!showDashboard) {
    <div [style]="viewStyle">
      @for (element of metaData.tabs; track element.objectName) {
        @if (element.visible) {
          <app-gts-tabs
            [style]="'grid-area: '+element.gridArea"
            [prjId]="prjId"
            [formId]="formId"
            [objectName]="element.objectName"
          ></app-gts-tabs>
        }
      }

      @for (element of metaData.toolbars; track element.objectName) {
        @if (element.visible && element.objectName != 'mainToolbar' && !element.toolbarFlagSubmit) {
          <app-gts-toolbar
            [style]="'grid-area: '+element.gridArea"
            [prjId]="prjId"
            [formId]="formId"
            [objectName]="element.objectName"
            [customCssClass]="element.customCssClass"
            (newValueEvent)="gtsDataService.toolbarSelectEvent($event)"
          ></app-gts-toolbar>
        }
      }

      @for (element of metaData.grids; track element.objectName) {
        @if (element.visible) {
          <app-gts-grid
            [style]="'grid-area: '+element.gridArea"
            [prjId]="prjId"
            [formId]="formId"
            [objectName]="element.objectName"
          ></app-gts-grid>
        }
      }

      @for (element of metaData.forms; track element.objectName) {
        @if (element.visible && !element.groupShowPopUp) {
          <app-gts-form
            [style]="'grid-area: '+element.gridArea"
            [prjId]="prjId"
            [formId]="formId"
            [objectName]="element.objectName"
          ></app-gts-form>
        }
        @if (element.visible && element.groupShowPopUp) {
          <app-gts-form-popup
            [prjId]="prjId"
            [formId]="formId"
            [objectName]="element.objectName"
          ></app-gts-form-popup>
        }
      }
    </div>
  }

  <!-- DASHBOARD VIEW -->
  @if (showDashboard) {
    <div class="sales-dashboard">

      <!-- GTS DASHBOARD (Metadata-driven) -->
      <app-gts-dashboard
        [config]="gtsDashboardConfig"
        [rawData]="rawExcelData"
        [visible]="true"
        (onRefresh)="onGtsDashboardRefresh()"
        (onDataRequest)="onDashboardDataRequest($event)">
      </app-gts-dashboard>

    </div>
  }

  <app-gts-message
    [prjId]="prjId"
    [formId]="formId"
  ></app-gts-message>

  <!-- GTS AI Analyzer Component (reusable) -->
  <app-gts-ai-analyzer
    [data]="gtsAiAnalyzerData"
    [config]="gtsAiAnalyzerConfig"
    [(visible)]="showGtsAiAnalyzer">
  </app-gts-ai-analyzer>
</div>
