<ion-modal [isOpen]="fileUploadVisible" (didDismiss)="closeModal()" class="file-uploader-modal">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>{{ uploaderTitle }}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeModal()">
            <ion-icon slot="icon-only" name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">
      @if (loading) {
        <app-gts-loader></app-gts-loader>
      }

      <div class="upload-container">
        <!-- File Input Area -->
        <div class="file-input-area">
          <input
            #fileInput
            type="file"
            (change)="onFileSelected($event)"
            [accept]="acceptedFileTypes"
            class="file-input"
            id="fileInput"
          />
          <label for="fileInput" class="file-input-label">
            <ion-icon name="cloud-upload" class="upload-icon"></ion-icon>
            <p class="upload-text">Click to select a file or drag and drop</p>
            @if (allowedExtensions.length > 0) {
              <p class="allowed-types">Allowed types: {{ allowedExtensions.join(', ') }}</p>
            }
            @if (maxFileSize > 0) {
              <p class="max-size">Max size: {{ getFileSize(maxFileSize) }}</p>
            }
          </label>
        </div>

        <!-- Selected File Info -->
        @if (selectedFile) {
          <ion-list class="selected-file-info">
            <ion-item>
              <ion-icon slot="start" name="document" color="primary"></ion-icon>
              <ion-label>
                <h3>{{ selectedFile.name }}</h3>
                <p>{{ getFileSize(selectedFile.size) }}</p>
              </ion-label>
            </ion-item>
          </ion-list>
        }

        <!-- Upload Progress -->
        @if (uploadProgress > 0 && uploadProgress < 100) {
          <div class="progress-container">
            <ion-progress-bar [value]="uploadProgress / 100"></ion-progress-bar>
            <p class="progress-text">Uploading: {{ uploadProgress }}%</p>
          </div>
        }

        <!-- Error Message -->
        @if (errorMessage) {
          <div class="error-message">
            <p>{{ errorMessage }}</p>
          </div>
        }

        <!-- Upload Button -->
        <div class="button-container">
          <ion-button
            expand="block"
            (click)="uploadFile()"
            [disabled]="!selectedFile || loading"
            color="primary"
          >
            <ion-icon slot="start" name="cloud-upload"></ion-icon>
            Upload File
          </ion-button>
        </div>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
